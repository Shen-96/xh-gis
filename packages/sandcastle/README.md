# XH-GIS Sandcastle

XH-GIS Sandcastle æ˜¯ä¸€ä¸ªç¤ºä¾‹å±•ç¤ºå’Œæµ‹è¯•å¹³å°ï¼Œç”¨äºæ¼”ç¤º XH-GIS Engine å’Œ Widgets çš„å„ç§åŠŸèƒ½å’Œåº”ç”¨åœºæ™¯ã€‚

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### ğŸ“– ç¤ºä¾‹å±•ç¤º
- **åŸºç¡€ç¤ºä¾‹**: åœ°å›¾åˆå§‹åŒ–ã€å›¾å½¢ç»˜åˆ¶ã€UIç»„ä»¶ç­‰åŸºç¡€åŠŸèƒ½
- **é«˜çº§ç¤ºä¾‹**: å¤æ‚äº¤äº’ã€ç©ºé—´åˆ†æã€åŠ¨æ€æ•ˆæœç­‰é«˜çº§åŠŸèƒ½  
- **é›†æˆç¤ºä¾‹**: å®Œæ•´åº”ç”¨åœºæ™¯çš„ç«¯åˆ°ç«¯æ¼”ç¤º

### ğŸ§ª åŠŸèƒ½æµ‹è¯•
- **è‡ªåŠ¨åŒ–æµ‹è¯•**: Engine å’Œ Widgets æ ¸å¿ƒåŠŸèƒ½çš„è‡ªåŠ¨åŒ–æµ‹è¯•
- **æ€§èƒ½æµ‹è¯•**: æ¸²æŸ“æ€§èƒ½ã€å†…å­˜ä½¿ç”¨ç­‰æ€§èƒ½åŸºå‡†æµ‹è¯•
- **é›†æˆæµ‹è¯•**: æ¨¡å—é—´åä½œçš„é›†æˆæµ‹è¯•

### ğŸ¨ äº¤äº’ç•Œé¢
- **ç°ä»£åŒ–UI**: åŸºäº React + TypeScript çš„ç°ä»£åŒ–ç•Œé¢
- **å“åº”å¼è®¾è®¡**: æ”¯æŒæ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡
- **ä»£ç å±•ç¤º**: æ¯ä¸ªç¤ºä¾‹éƒ½åŒ…å«ç›¸åº”çš„ä»£ç æ¼”ç¤º

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
pnpm install
```

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
# å¯åŠ¨ Sandcastle å¼€å‘æœåŠ¡å™¨
cd packages/sandcastle
pnpm dev
```

è®¿é—® `http://localhost:3000` æŸ¥çœ‹ç¤ºä¾‹å’Œæµ‹è¯•å¹³å°ã€‚

### æ„å»º

```bash
# æ„å»º Sandcastle
cd packages/sandcastle
pnpm build
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
packages/sandcastle/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/          # å…¬å…±ç»„ä»¶
â”‚   â”‚   â””â”€â”€ Layout.tsx       # å¸ƒå±€ç»„ä»¶
â”‚   â”œâ”€â”€ pages/               # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Home.tsx         # é¦–é¡µ
â”‚   â”‚   â”œâ”€â”€ ExamplesList.tsx # ç¤ºä¾‹åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ TestingSuite.tsx # æµ‹è¯•å¥—ä»¶
â”‚   â”‚   â””â”€â”€ NotFound.tsx     # 404é¡µé¢
â”‚   â”œâ”€â”€ examples/            # ç¤ºä¾‹æ¼”ç¤º
â”‚   â”‚   â”œâ”€â”€ basic/           # åŸºç¡€ç¤ºä¾‹
â”‚   â”‚   â”œâ”€â”€ advanced/        # é«˜çº§ç¤ºä¾‹ (è®¡åˆ’ä¸­)
â”‚   â”‚   â””â”€â”€ integration/     # é›†æˆç¤ºä¾‹ (è®¡åˆ’ä¸­)
â”‚   â”œâ”€â”€ tests/               # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ styles/              # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ utils/               # å·¥å…·å‡½æ•°
â”œâ”€â”€ public/                  # é™æ€èµ„æº
â”œâ”€â”€ package.json             # åŒ…é…ç½®
â”œâ”€â”€ tsconfig.json           # TypeScripté…ç½®
â”œâ”€â”€ vite.config.ts          # Viteé…ç½®
â””â”€â”€ jest.config.js          # Jestæµ‹è¯•é…ç½®
```

## ğŸ¯ ç¤ºä¾‹ç±»åˆ«

### åŸºç¡€ç¤ºä¾‹ (Basic Examples)

1. **åŸºç¡€åœ°å›¾** (`/examples/basic/map`)
   - 3Dåœ°çƒåˆå§‹åŒ–
   - ç›¸æœºæ§åˆ¶
   - åŸºç¡€äº¤äº’

2. **å›¾å½¢ç»˜åˆ¶** (`/examples/basic/drawing`)
   - ç‚¹ã€çº¿ã€é¢ç»˜åˆ¶
   - å›¾å½¢ç¼–è¾‘
   - æ ·å¼è®¾ç½®

3. **UIç»„ä»¶** (`/examples/basic/widgets`)
   - å·¥å…·æ ç»„ä»¶
   - æ—¶é—´è½´ç»„ä»¶
   - å¼¹çª—ç»„ä»¶

### é«˜çº§ç¤ºä¾‹ (Advanced Examples) - è®¡åˆ’ä¸­

- ç©ºé—´åˆ†æ
- åŠ¨æ€æè´¨
- æ—¶é—´åŠ¨ç”»
- å¤©æ°”æ¨¡æ‹Ÿ

### é›†æˆç¤ºä¾‹ (Integration Examples) - è®¡åˆ’ä¸­

- å®Œæ•´GISåº”ç”¨
- æ•°æ®å¯è§†åŒ–
- å®æ—¶ç›‘æ§

## ğŸ§ª æµ‹è¯•å¥—ä»¶

Sandcastle åŒ…å«å®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼š

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pnpm test

# ç›‘è§†æ¨¡å¼è¿è¡Œæµ‹è¯•
pnpm test:watch

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pnpm test:coverage
```

### æµ‹è¯•è¦†ç›–èŒƒå›´

- **EngineåŒ…æµ‹è¯•**: åœ°å›¾å¼•æ“æ ¸å¿ƒåŠŸèƒ½
- **WidgetsåŒ…æµ‹è¯•**: Reactç»„ä»¶æ¸²æŸ“å’Œäº¤äº’
- **é›†æˆæµ‹è¯•**: æ¨¡å—é—´åä½œåŠŸèƒ½
- **æ€§èƒ½æµ‹è¯•**: æ¸²æŸ“æ€§èƒ½å’Œå†…å­˜ä½¿ç”¨

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: React 18 + TypeScript
- **æ„å»ºå·¥å…·**: Vite
- **æµ‹è¯•æ¡†æ¶**: Jest + React Testing Library
- **è·¯ç”±**: React Router v6
- **æ ·å¼**: CSS Modules
- **åŒ…ç®¡ç†**: pnpm

## ğŸ“ è´¡çŒ®æŒ‡å—

### æ·»åŠ æ–°ç¤ºä¾‹

1. åœ¨å¯¹åº”ç›®å½•åˆ›å»ºç¤ºä¾‹ç»„ä»¶ (`src/examples/{category}/{ExampleName}.tsx`)
2. æ·»åŠ è·¯ç”±é…ç½® (`src/App.tsx`)
3. æ›´æ–°ç¤ºä¾‹åˆ—è¡¨ (`src/pages/ExamplesList.tsx`)
4. ç¼–å†™ç›¸åº”çš„æµ‹è¯•ç”¨ä¾‹

### æ·»åŠ æµ‹è¯•ç”¨ä¾‹

1. åœ¨ `src/tests/` ç›®å½•åˆ›å»ºæµ‹è¯•æ–‡ä»¶
2. ä½¿ç”¨ Jest + React Testing Library ç¼–å†™æµ‹è¯•
3. ç¡®ä¿æµ‹è¯•è¦†ç›–ç‡è¾¾åˆ°è¦æ±‚

## ğŸ”— ç›¸å…³é“¾æ¥

- [XH-GIS Engine æ–‡æ¡£](../engine/README.md)
- [XH-GIS Widgets æ–‡æ¡£](../widgets/README.md)
- [é¡¹ç›®ä¸»é¡µ](../../README.md)

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](../../LICENSE) æ–‡ä»¶ã€‚


## ğŸ”¥ çƒ­åº¦å›¾ç¤ºä¾‹

Sandcastle æä¾›äº†åŸºç¡€çƒ­åº¦å›¾ç¤ºä¾‹ï¼Œæ¼”ç¤º `@xh-gis/engine` çš„ `HeatmapLayer` ä»¥åŠç­‰å€¼çº¿èƒ½åŠ›ï¼š

- è·¯å¾„ï¼š`/examples/basic/heatmap`
- ä¸»è¦åŠŸèƒ½ï¼š
  - åŸºäº Canvas çš„çƒ­åº¦å›¾æ¸²æŸ“ï¼ˆimagery æ¨¡å¼ï¼‰
  - ç­‰å€¼çº¿å åŠ ï¼ˆd3-contourï¼‰ï¼Œæ”¯æŒå¹³æ»‘æ˜¾ç¤º
  - ç»Ÿä¸€é¢œè‰²è¦†ç›–ï¼ˆä¾‹å¦‚ç™½è‰² `#fff`ï¼‰
  - ç­‰å€¼çº¿åˆ†å±‚æ•°é‡é»˜è®¤ä¸çƒ­åº¦å›¾æ¢¯åº¦åœé æ•°ä¸€è‡´
  - é»˜è®¤çº¿å®½ä¸º `1`

### ç¤ºä¾‹ä»£ç ç‰‡æ®µ

```tsx
import { XgEarth } from "@xh-gis/engine";

const points = /* éšæœºæˆ–ä¸šåŠ¡æ•°æ® */[];

const options = {
  renderType: "imagery",
  points,
  heatmapOptions: {
    radius: 30,
    gradient: {
      0.25: "rgb(0,0,255)",
      0.55: "rgb(0,255,0)",
      0.85: "yellow",
      1.0: "rgb(255,0,0)",
    },
  },
  heatmapDataOptions: { min: 0, max: 100 },
  zoomToLayer: true,
  contourLineOption: {
    show: true,
    color: "#fff",         // ç»Ÿä¸€ç™½è‰²ç­‰å€¼çº¿ï¼Œå¢å¼ºå¯è§æ€§
    thresholdMode: "equalInterval", // æˆ– "quantile" | "custom"
    smooth: true,
  },
};

// é€šè¿‡ HeatmapManager ç®¡ç†å®ä¾‹
const id = "demo-heatmap";
if (!earth.heatmapManager.isExists(id)) {
  earth.heatmapManager.add(id, options);
}
```

### æç¤º
- å¦‚æœéœ€è¦æ›´å‡è¡¡çš„è§†è§‰åˆ†å±‚ï¼Œå¯é€‰æ‹© `thresholdMode = "quantile"`ã€‚
- ä¸šåŠ¡éœ€è¦å›ºå®šé˜ˆå€¼æ—¶ï¼Œä½¿ç”¨ `customThresholds` å¹¶å°† `thresholdMode` è®¾ä¸º `custom`ã€‚
- é»˜è®¤é€æ˜åº¦å¢å¼ºä¸‹é™ä¸º `0.4`ï¼Œåœ¨æµ…è‰²èƒŒæ™¯ä¸Šå¯ä»¥æ›´å¥½åœ°è¯†åˆ«çº¿æ¡ã€‚